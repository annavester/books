require(["jquery","jquery-ui"],function(a){"use strict";var b=b||{};b.endlessMargin=20,b.dialogOptions={width:700,modal:!0,beforeClose:function(){a(this).empty()}},b.initTooltip=function(){a(".tooltip").length&&a(".tooltip").hover(function(){a("aside",this)&&a("aside",this).show()},function(){a("aside",this).hide()})},b.init=function(){b.initTooltip(),a("body").on("endless",function(){var b=a(this).find(".endless_container"),c=b.find(".endless_loading"),d=b.find("a");c.show();var e="querystring_key="+d.prop("rel").split(" ")[0];return a.get(d.prop("href"),e,function(a){b.before(a).remove()}),!1});var c=1;"undefined"!=typeof b.endlessMargin&&(c=b.endlessMargin),a(window).scroll(function(){var d=a(window);a(document).height()-d.height()-d.scrollTop()<=c&&(a("body").trigger("endless"),a(".tooltip").off("hover"),b.initTooltip())}),a("body").on("click","article.book",function(c){var d=a(this),e=d.data("book-id")||d.parents("article").data("book-id"),f="";return a(c.target).hasClass("aUpdateStatus")?(b.updateStatus(e),!1):a(c.target).hasClass(".ui-icon-trash")?(b.deleteBook(e),!1):(f=d.find("> a").prop("title"),a.get("/book/"+e+"/",function(c){b.openDialog(c,a.extend(b.dialogOptions,{title:f}))}),!1)})},b.updateStatus=function(c){var d={title:"Update Status",open:function(){b.Book.openUpdateStatus()}};a.get("/book/"+c+"/update_status",function(c){b.openDialog(c,a.extend(b.dialogOptions,d))})},b.deleteBook=function(c){var d={title:"Delete Book",open:function(){setTimeout(function(){this.close()},100)}};a.get("/book/"+c+"/delete",function(c){b.openDialog(c,a.extend(b.dialogOptions,d))})},b.openDialog=function(b,c){a("#dialog").empty().append(b).dialog(c)},b.Book={message:null,book:null,objType:null,openUpdateStatus:function(){a("#id_status").change(function(){var b=a(this);"1"===b.val()?b.next().show():b.next().hide()})},init:function(c,d){var e=c;b.Book.objType=d,a(".aAddToList").click(function(b){b.preventDefault(),a.get("/book/"+e+"/add_to_list",function(){})}),a(".aUpdateOwn").click(function(b){b.preventDefault(),a.get("/book/"+e+"/update_own",function(){})}),a(".aAddWebsite").click(function(b){b.preventDefault(),a.get("/author/"+e+"/add_website",function(){})}),a(".aAddBio").click(function(b){b.preventDefault(),a.get("/author/"+e+"/add_bio",function(){})}),a(".aAddWiki").click(function(b){b.preventDefault(),a.get("/author/"+e+"/add_wiki",function(){})})},show:function(c){a("#status-container .status-save").click(function(d){d.preventDefault();var e="",f="";b.Book.validate()?(e=a("#status-container .status-message"),e.fadeOut(function(){e.removeClass("status-error").empty()}),a("#status-container .status-title").text("Sending..."),a("#status-container form").fadeOut(200),a("#status-container .status-content").animate({height:"80px"},function(){a("#status-container .status-loading").fadeIn(200,function(){f="author"===b.Book.objType?"/author/"+c+"/":"/book/"+c+"/",a.ajax({url:f,data:a("#status-container form").serialize()+"&action=send",type:"post",cache:!1,dataType:"html",success:function(){a("#status-container .status-loading").fadeOut(200,function(){a("#status-container .status-title").text("Thank you!")})},error:b.Book.error})})})):a("#status-container .status-message:visible").length>0?(e=a("#status-container .status-message div"),e.fadeOut(200,function(){e.empty(),b.Book.showError(),e.fadeIn(200)})):a("#status-container .status-message").animate({height:"30px"},b.Book.showError)})},error:function(a){alert(a.statusText)},validate:function(){return b.Book.message="",a("#id_status").length?(a("#status-container #id_status").val()||(b.Book.message+="Status is required. "),"1"===a("#status-container #id_status").val()&&("0"===a("#status-container #id_rating").val()&&(b.Book.message+="Rating is required. "),a("#status-container #id_datefinished").val()||(b.Book.message+="Date Finished is required. "),a("#status-container #id_review").val()||(b.Book.message+="Review is required."))):a("#id_readinglist").length&&(a("#status-container #id_readinglist").val()||(b.Book.message+="Readinglist is required. ")),b.Book.message.length?!0:!1},showError:function(){a("#status-container .status-message").html(a('<div class="status-error"></div>').append(b.Book.message)).fadeIn(200)}},function(a,b){var c=function(a,b,c){var d;return function(){function e(){c||a.apply(f,g),d=null}var f=this,g=arguments;d?clearTimeout(d):c&&a.apply(f,g),d=setTimeout(e,b||100)}};a.fn[b]=function(a){return a?this.bind("resize",c(a)):this.trigger(b)}}(a,"smartresize"),b.init()});